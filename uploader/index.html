<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>omaBOX Uploader</title>
</head>
<body>
  <script>
    async function upload(files)
    {
      const authorizationToken = 'FIXME'
      const uploadUrl = 'FIXME'
      const [ file ] = files
      await fetch(uploadUrl, {
        method: 'POST',
        headers: {
          'Authorization': authorizationToken,
          'X-Bz-File-Name': randomizeFilename(file),
          'X-Bz-Content-Sha1': 'do_not_verify'
        },
        body: file
      })
    }

    function randomizeFilename(file)
    {
      return Math.random().toString(36).substring(2) + '.' + file.name.split('.').pop()
    }
  </script>

  <header style="text-align:center">
    <svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" width="158.99998" height="209.80341" fill="#000000" viewBox="0 0 211.99999 279.73787" version="1.1" id="svg12" sodipodi:docname="package.svg.2020_11_27_15_44_27.0.svg" inkscape:version="1.0.1 (0767f8302a, 2020-10-17)"> <metadata id="metadata18"> <rdf:RDF> <cc:Work rdf:about=""> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" /> <dc:title></dc:title> </cc:Work> </rdf:RDF> </metadata> <defs id="defs16"> <rect x="227.6537" y="121.35257" width="113.68381" height="86.260979" id="rect868" /> <rect x="-84.742783" y="220.19572" width="536.53448" height="171.69887" id="rect845" /> </defs> <sodipodi:namedview pagecolor="#ffffff" bordercolor="#666666" borderopacity="1" objecttolerance="10" gridtolerance="10" guidetolerance="10" inkscape:pageopacity="0" inkscape:pageshadow="2" inkscape:window-width="1915" inkscape:window-height="1016" id="namedview14" showgrid="false" fit-margin-top="8" fit-margin-left="8" fit-margin-right="8" fit-margin-bottom="8" inkscape:document-rotation="0" inkscape:zoom="1.9052002" inkscape:cx="-1.2149497" inkscape:cy="141.1024" inkscape:window-x="26" inkscape:window-y="23" inkscape:window-maximized="0" inkscape:current-layer="svg12" /> <line x1="107.0617" y1="116.80875" x2="106.00002" y2="219.61908" fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" id="line4" style="stroke-width:6.66667;stroke-miterlimit:4;stroke-dasharray:none" /> <path d="M 197.99999,164.14101 V 69.476452 a 8,8 0 0 0 -4.06354,-6.9645 l -83.99999,-47.47826 a 8,8 0 0 0 -7.87292,0 l -83.999998,47.47826 a 8,8 0 0 0 -4.06354,6.9645 v 94.664558 a 8,8 0 0 0 4.06354,6.96451 l 83.999998,47.47826 a 8,8 0 0 0 7.87292,0 l 83.99999,-47.47826 a 8,8 0 0 0 4.06354,-6.96451 z" fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" id="path6" style="stroke-width:6.66667;stroke-miterlimit:4;stroke-dasharray:none" /> <polyline points="218.792 76.627 128.949 128 36.99 76.616" fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" id="polyline8" style="stroke-width:6.66667;stroke-miterlimit:4;stroke-dasharray:none" transform="translate(-21.887449,-11.191267)" /> <polyline points="177.022 148.511 177.022 100.511 84.243 48.669" fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="16" id="polyline10" style="stroke-width:6.66667;stroke-miterlimit:4;stroke-dasharray:none" transform="translate(-21.887449,-11.191267)" /> <g id="g877" transform="translate(-18.163204,1.6493852)"> <text xml:space="preserve" id="text843" style="font-style:normal;font-weight:normal;font-size:53.3333px;line-height:1;font-family:sans-serif;white-space:pre;shape-inside:url(#rect845);fill:#000000;fill-opacity:1;stroke:none;" transform="translate(116.09324,5.3114228)"><tspan x="-84.742188" y="261.51145"><tspan style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:cmmi10;-inkscape-font-specification:cmmi10;letter-spacing:-4.34667px">oma</tspan></tspan></text> <text xml:space="preserve" id="text866" style="font-style:normal;font-weight:normal;font-size:49.7778px;line-height:1.25;font-family:sans-serif;white-space:pre;shape-inside:url(#rect868);fill:#000000;fill-opacity:1;stroke:none;" transform="translate(-99.949811,101.68635)"><tspan x="227.6543" y="165.3952"><tspan style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:49.7778px;font-family:Carlito;-inkscape-font-specification:Carlito">BOX</tspan></tspan></text></g></svg>
  </header>

  <form style="text-align:center;padding:1em 0">
    <p><input type="file" accept="image/png, image/jpeg" oninput="upload(this.files)"></p>
  </form>

 <details>
    <summary>Documentation</summary>
    <p>Uploads an image to a Backblaze B2 bucket via an authorized upload URL.</a>
    </p>
    <p>Set custom CORS rules on the bucket via the B2 CLI client and wait 10 minutes. Custom rules can not be added via the web UI.</p>
    <pre>
    $ b2 update-bucket --corsRules '[
      {
          "corsRuleName": "uploadFromAnyOrigin",
          "allowedOrigins": ["*"],
          "allowedHeaders": ["*"],
          "allowedOperations": ["b2_upload_file", "b2_upload_part"],
          "exposeHeaders": ["authorization", "x-bz-file-name", "x-bz-content-sha1"]
      }]' &lt;bucket-name&gt; allPublic
    </pre>
    <p>Get the <var>accountAuthToken</var> and <var>bucketId</var> via the B2 CLI client. Next use cURL to get an <var>uploadUrl</var> and temporary <var>authorizationToken</var> (valid for 24 hours) from Backblaze. Use these in the script above.</p>
    <pre>
    $ b2 get-account-info
    $ curl \
      -H 'Authorization: accountAuthToken' \
      -d '{"bucketId": "bucketId"}' \
      https://apiNNN.backblazeb2.com/b2api/v2/b2_get_upload_url
    </pre>
  </details>
</body>
</html>
