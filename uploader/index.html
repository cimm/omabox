<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>omaBOX Uploader</title>
</head>
<body>
  <script>
    async function upload(files)
    {
      const authorizationToken = 'FIXME'
      const uploadUrl = 'FIXME'
      const [ file ] = files
      await fetch(uploadUrl, {
        method: 'POST',
        headers: {
          'Authorization': authorizationToken,
          'X-Bz-File-Name': randomizeFilename(file),
          'X-Bz-Content-Sha1': 'do_not_verify'
        },
        body: file
      })
    }

    function randomizeFilename(file)
    {
      return Math.random().toString(36).substring(2) + '.' + file.name.split('.').pop()
    }
  </script>

  <form>
    <p><input type="file" accept="image/png, image/jpeg" oninput="upload(this.files)"></p>
  </form>

 <details>
    <summary>Documentation</summary>
    <p>Uploads an image to a Backblaze B2 bucket via an authorized upload URL.</a>
    </p>
    <p>Set custom CORS rules on the bucket via the B2 CLI client and wait 10 minutes. Custom rules can not be added via the web UI.</p>
    <pre>
    $ b2 update-bucket --corsRules '[
      {
          "corsRuleName": "uploadFromAnyOrigin",
          "allowedOrigins": ["*"],
          "allowedHeaders": ["*"],
          "allowedOperations": ["b2_upload_file", "b2_upload_part"],
          "exposeHeaders": ["authorization", "x-bz-file-name", "x-bz-content-sha1"]
      }]' &lt;bucket-name&gt; allPublic
    </pre>
    <p>Get the <var>accountAuthToken</var> and <var>bucketId</var> via the B2 CLI client. Next use cURL to get an <var>uploadUrl</var> and temporary <var>authorizationToken</var> (valid for 24 hours) from Backblaze. Use these in the script above.</p>
    <pre>
    $ b2 get-account-info
    $ curl \
      -H 'Authorization: accountAuthToken' \
      -d '{"bucketId": "bucketId"}' \
      https://apiNNN.backblazeb2.com/b2api/v2/b2_get_upload_url
    </pre>
  </details>
</body>
</html>
